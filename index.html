<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>反射する点のシミュレーション</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #fff;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(100, 1fr);
            grid-template-rows: repeat(100, 1fr);
            gap: 1px;
            width: 500px;
            height: 500px;
            border: 2px solid black;
            position: relative;
        }

        .cell {
            background-color: white;
            border: 1px solid lightgray;
        }

        .dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: black;
            border-radius: 50%;
        }

        .buttons {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="board" id="board">
        <!-- 100x100 grid -->
        <div class="cell"></div>
        <!-- 9999 more cells will be automatically created -->
    </div>

    <div class="buttons">
        <button onclick="startGame()">開始</button>
        <button onclick="stopGame()">停止</button>
        <button onclick="resetGame()">リセット</button>
    </div>

    <script>
        const board = document.getElementById('board');
        const dots = [];
        const numDots = 10;
        let gameInterval;
        let resetInterval;

        // 盤面の初期化
        for (let i = 0; i < 100 * 100; i++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            board.appendChild(cell);
        }

        function createDot() {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            dot.style.left = `${Math.floor(Math.random() * 100) * 5}px`;
            dot.style.top = `${Math.floor(Math.random() * 100) * 5}px`;
            dot.velocityX = (Math.random() * (Math.random() < 0.5 ? -1 : 1) + 0.2).toFixed(2);
            dot.velocityY = (Math.random() * (Math.random() < 0.5 ? -1 : 1) + 0.2).toFixed(2);
            dots.push(dot);
            board.appendChild(dot);
        }

        function moveDots() {
            dots.forEach(dot => {
                let x = parseFloat(dot.style.left);
                let y = parseFloat(dot.style.top);

                // 端で反射
                if (x <= 0 || x >= 495) dot.velocityX *= -1;
                if (y <= 0 || y >= 495) dot.velocityY *= -1;

                // 点同士の反射処理 (簡易版)
                dots.forEach(otherDot => {
                    if (dot !== otherDot) {
                        let dx = x - parseFloat(otherDot.style.left);
                        let dy = y - parseFloat(otherDot.style.top);
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 10) {
                            dot.velocityX *= -1;
                            dot.velocityY *= -1;
                            otherDot.velocityX *= -1;
                            otherDot.velocityY *= -1;
                        }
                    }
                });

                // 点を移動
                dot.style.left = `${x + parseFloat(dot.velocityX)}px`;
                dot.style.top = `${y + parseFloat(dot.velocityY)}px`;
            });
        }

        function startGame() {
            // 初期化
            for (let i = 0; i < numDots; i++) {
                createDot();
            }

            // 1秒間隔で点を動かす
            gameInterval = setInterval(moveDots, 50);

            // 1分ごとにリセット
            resetInterval = setInterval(resetGame, 60000);
        }

        function stopGame() {
            clearInterval(gameInterval);
            clearInterval(resetInterval);
        }

        function resetGame() {
            dots.forEach(dot => dot.remove());
            dots.length = 0;
            startGame();
        }
    </script>
</body>
</html>
