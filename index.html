<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>反射箱</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #fff;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(100, 10px);
            grid-template-rows: repeat(100, 10px);
            gap: 0;
            border: 4px solid #000;
        }

        .cell {
            width: 10px;
            height: 10px;
            border: 1px solid #ddd;
            background-color: #fff;
        }

        .black {
            background-color: #000;
        }

        .ant {
            width: 10px;
            height: 10px;
            background-color: black;
            position: absolute;
        }

        .button-container {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            width: 300px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #ddd;
            border: none;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #bbb;
        }
    </style>
</head>
<body>

<div id="grid"></div>
<div class="button-container">
    <button onclick="start()">開始</button>
    <button onclick="stop()">停止</button>
    <button onclick="reset()">リセット</button>
</div>

<script>
    const gridSize = 100;
    const grid = document.getElementById('grid');
    const ants = [];
    let interval;
    let isRunning = false;

    // 盤面の作成
    const cells = [];
    for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        grid.appendChild(cell);
        cells.push(cell);
    }

    // 初期位置のランダムな点10個を配置
    for (let i = 0; i < 10; i++) {
        ants.push({
            x: Math.floor(Math.random() * gridSize),
            y: Math.floor(Math.random() * gridSize),
            direction: Math.floor(Math.random() * 4),  // 0: 上, 1: 右, 2: 下, 3: 左
        });
    }

    // 点の移動
    function moveAnts() {
        for (let ant of ants) {
            const index = ant.y * gridSize + ant.x;
            const currentCell = cells[index];
            
            if (currentCell.classList.contains('black')) {
                // 黒いセルなら反時計回りに方向を変更
                ant.direction = (ant.direction + 3) % 4;
                currentCell.classList.remove('black');
            } else {
                // 白いセルなら時計回りに方向を変更
                ant.direction = (ant.direction + 1) % 4;
                currentCell.classList.add('black');
            }

            // 移動
            if (ant.direction === 0) { // 上
                ant.y = (ant.y - 1 + gridSize) % gridSize;
            } else if (ant.direction === 1) { // 右
                ant.x = (ant.x + 1) % gridSize;
            } else if (ant.direction === 2) { // 下
                ant.y = (ant.y + 1) % gridSize;
            } else if (ant.direction === 3) { // 左
                ant.x = (ant.x - 1 + gridSize) % gridSize;
            }

            // 端にぶつかると反射
            if (ant.x < 0) ant.x = 0;
            if (ant.x >= gridSize) ant.x = gridSize - 1;
            if (ant.y < 0) ant.y = 0;
            if (ant.y >= gridSize) ant.y = gridSize - 1;
        }

        // 現在のアリの位置を描画
        renderAnts();
    }

    // アリを描画
    function renderAnts() {
        // 全てのアリをリセット
        const antElements = document.querySelectorAll('.ant');
        antElements.forEach((ant) => ant.remove());

        for (let ant of ants) {
            const antElement = document.createElement('div');
            antElement.classList.add('ant');
            antElement.style.top = `${ant.y * 10}px`;
            antElement.style.left = `${ant.x * 10}px`;
            grid.appendChild(antElement);
        }
    }

    // 開始
    function start() {
        if (!isRunning) {
            isRunning = true;
            interval = setInterval(moveAnts, 20);
        }
    }

    // 停止
    function stop() {
        clearInterval(interval);
        isRunning = false;
    }

    // リセット
    function reset() {
        stop();
        ants.length = 0;

        for (let i = 0; i < 10; i++) {
            ants.push({
                x: Math.floor(Math.random() * gridSize),
                y: Math.floor(Math.random() * gridSize),
                direction: Math.floor(Math.random() * 4),
            });
        }

        cells.forEach(cell => cell.classList.remove('black'));
        renderAnts();
    }

    // 最初にアリを描画
    renderAnts();

</script>

</body>
</html>
